<Page navigatingTo="onNavigatingTo" unloaded="onUnloaded" xmlns="http://schemas.nativescript.org/tns.xsd">
  <ActionBar class="app-bar" flat="true">
    <ActionBar.titleView>
      <GridLayout columns="auto,*" class="app-bar-grid">
        <FlexboxLayout col="0" class="brand">
          <Image class="brand-icon" src="~/assets/logo.png" />
          <Label class="brand-title">
            <FormattedString>
              <Span text="Tic-Tac-Toe" />
              <Span text="Twist" class="twist" />
            </FormattedString>
          </Label>
        </FlexboxLayout>
        <FlexboxLayout col="1"
                      class="avatar-container"
                      horizontalAlignment="right"
                      verticalAlignment="center"
                      justifyContent="center"
                      alignItems="center">
          <GridLayout rows="auto" columns="auto">
            <Image class="avatar-image"
                   src="{{ authAvatarUrl }}"
                   visibility="{{ authLoggedIn &amp;&amp; authAvatarUrl ? 'visible' : 'collapse' }}" />
            <Label class="avatar-initial"
                   text="{{ authInitial }}"
                   visibility="{{ authLoggedIn &amp;&amp; !authAvatarUrl ? 'visible' : 'collapse' }}" />
            <Label class="avatar-login"
                   text="âŽ†"
                   visibility="{{ authLoggedIn ? 'collapse' : 'visible' }}" />
            <StackLayout class="avatar-badge"
                        visibility="{{ badgeVisible ? 'visible' : 'collapse' }}"
                        horizontalAlignment="right"
                        verticalAlignment="top">
              <Label class="avatar-badge-icon"
                    text="{{ badgeIcon }}"
                    horizontalAlignment="center"
                    verticalAlignment="center" />
            </StackLayout>
          </GridLayout>
        </FlexboxLayout>
      </GridLayout>
    </ActionBar.titleView>
  </ActionBar>

  <GridLayout rows="*, auto">
    <ScrollView row="0">
      <StackLayout class="profile-screen" spacing="20">
        <GridLayout class="profile-avatar-shell"
                    horizontalAlignment="center"
                    verticalAlignment="center"
                    tap="onAvatarTap">
          <Image class="profile-avatar"
                 src="{{ authAvatarUrl }}"
                 visibility="{{ authLoggedIn &amp;&amp; authAvatarUrl ? 'visible' : 'collapse' }}" />
          <Label class="profile-avatar-fallback"
                 text="{{ authInitial }}"
                 visibility="{{ authLoggedIn &amp;&amp; !authAvatarUrl ? 'visible' : 'collapse' }}" />
          <StackLayout class="profile-badge"
                       visibility="{{ badgeVisible ? 'visible' : 'collapse' }}"
                       horizontalAlignment="right"
                       verticalAlignment="top">
            <Label class="profile-badge-icon"
                   text="{{ badgeIcon }}"
                   horizontalAlignment="center"
                   verticalAlignment="center" />
          </StackLayout>
        </GridLayout>
        <StackLayout class="profile-card" spacing="12">
          <Label class="profile-name" text="{{ authDisplayName }}" />
          <Label class="profile-email" text="{{ authEmail }}" visibility="{{ authEmail ? 'visible' : 'collapse' }}" />
          <StackLayout visibility="{{ authProviderLabels &amp;&amp; authProviderLabels.length ? 'visible' : 'collapse' }}">
            <Label text="Linked providers:" />
            <Repeater items="{{ authProviderLabels }}">
              <Repeater.itemTemplate>
                <Label class="profile-provider" text="{{ 'â€º ' + $value }}" />
              </Repeater.itemTemplate>
            </Repeater>
          </StackLayout>
          <Label class="account-error"
                 text="{{ formError || authError }}"
                 visibility="{{ (formError || authError) ? 'visible' : 'collapse' }}"
                 textWrap="true" />
          <Button text="Edit display name"
                  class="account-primary"
                  tap="onEditDisplayName"
                  isEnabled="{{ authLoggedIn &amp;&amp; !authLoading }}" />
          <Button text="Sign out"
                  class="account-signout"
                  tap="onSignOut"
                  isEnabled="{{ authLoggedIn &amp;&amp; !authLoading }}" />
        </StackLayout>
        <StackLayout class="matches-section" spacing="12">
          <Label class="profile-section" text="My Matches" />
          <Label class="matches-error"
                 text="{{ matchSyncError }}"
                 textWrap="true"
                 visibility="{{ matchSyncError ? 'visible' : 'collapse' }}" />
          <Label class="matches-empty"
                 text="No matches yet. Play a game to start your library."
                 textWrap="true"
                 visibility="{{ matchesEmpty ? 'visible' : 'collapse' }}" />
          <Repeater items="{{ matchRows }}">
            <Repeater.itemTemplate>
              <GridLayout columns="*,*" class="match-row">
                <StackLayout col="0"
                             bindingContext="{{ left }}"
                             class="{{ cssClass }}"
                             visibility="{{ hidden ? 'collapse' : 'visible' }}"
                             tap="onMatchCardTap">
                  <Label class="match-card-outcome" text="{{ outcomeLabel }}" />
                  <Label class="match-card-opponent" text="{{ opponentLabel }}" />
                  <Label class="match-card-setup" text="{{ setupLabel }}" />
                  <Label class="match-card-moves" text="{{ movesLabel }}" />
                  <Label class="match-card-date" text="{{ dateLabel }}" />
                  <Label class="match-card-variants"
                         text="{{ variantsLabel }}"
                         textWrap="true" />
                </StackLayout>
                <StackLayout col="1"
                             bindingContext="{{ right }}"
                             class="{{ cssClass }}"
                             visibility="{{ hidden ? 'collapse' : 'visible' }}"
                             tap="onMatchCardTap">
                  <Label class="match-card-outcome" text="{{ outcomeLabel }}" />
                  <Label class="match-card-opponent" text="{{ opponentLabel }}" />
                  <Label class="match-card-setup" text="{{ setupLabel }}" />
                  <Label class="match-card-moves" text="{{ movesLabel }}" />
                  <Label class="match-card-date" text="{{ dateLabel }}" />
                  <Label class="match-card-variants"
                         text="{{ variantsLabel }}"
                         textWrap="true" />
                </StackLayout>
              </GridLayout>
            </Repeater.itemTemplate>
          </Repeater>
        </StackLayout>
        <StackLayout class="achievements-section" spacing="12">
          <Label class="profile-section" text="My Achievements" />
          <Repeater items="{{ achievements }}">
            <Repeater.itemTemplate>
              <GridLayout columns="auto,*" class="{{ cssClass }}" tap="onAchievementTap">
                <Label col="0" class="achievement-icon" text="{{ icon }}" verticalAlignment="top" />
                <StackLayout col="1" class="achievement-detail" spacing="4">
                  <FlexboxLayout alignItems="center">
                    <Label class="achievement-title" text="{{ title }}" />
                    <Label class="achievement-badge-tag"
                         text="Selected"
                         visibility="{{ isSelectedBadge ? 'visible' : 'collapse' }}" />
                  </FlexboxLayout>
                  <Label class="achievement-description" text="{{ description }}" textWrap="true" />
                  <Label class="achievement-meta" text="{{ difficultyLabel }}" />
                  <Label class="achievement-meta" text="{{ progressLabel }}" visibility="{{ progressLabel == 'Completed' ? 'collapse' : 'visible' }}" />
                  <Label class="achievement-earned"
                         text="{{ earnedDateLabel }}"
                         visibility="{{ earnedDateLabel ? 'visible' : 'collapse' }}" />
                </StackLayout>
              </GridLayout>
            </Repeater.itemTemplate>
          </Repeater>
        </StackLayout>
      </StackLayout>
    </ScrollView>

    <FlexboxLayout row="1" class="bottom-nav">
      <StackLayout class="btn" tap="onNavPlay">
        <Label text="â–¶ï¸" class="icon" />
        <Label text="PLAY" />
      </StackLayout>
      <StackLayout class="btn active">
        <Label text="ðŸ…" class="icon active" />
        <Label text="PROFILE" />
      </StackLayout>
      <StackLayout class="btn" tap="onNavAbout">
        <Label text="â„¹ï¸" class="icon" />
        <Label text="ABOUT" />
      </StackLayout>
    </FlexboxLayout>
  </GridLayout>
</Page>
